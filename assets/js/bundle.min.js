const nameInput=document.querySelector("#pseudo"),msgInput=document.querySelector("#msg"),checkButton=document.querySelector("#buttonInput"),messageContainer=document.querySelector(".touit_content"),formulaireInput=document.querySelector("#form");let currentTimeStamp=0;function addTouit(p,g,f,e,E,C){if(g){let e=document.createElement("article");e.className="touit",e.id=C;let t=document.createElement("p");t.className="touit_pseudo";p=document.createTextNode(p);t.appendChild(p),e.appendChild(t);let n=document.createElement("p");n.className="touit_message";g=document.createTextNode(g);n.appendChild(g),e.appendChild(n);let o=document.createElement("div");o.className="touit_icone_box";let s=document.createElement("p");s.className="likeNb",s.textContent=f;let a=document.createElement("button");a.className="like";let c=document.createElement("img");c.src="src/img/like.svg",o.appendChild(a),o.appendChild(s),a.appendChild(c);let i=document.createElement("button");i.className="comment";let d=document.createElement("img");d.src="src/img/comment.svg",i.appendChild(d),o.appendChild(i);let r=document.createElement("button");r.className="close";let u=document.createElement("img");u.src="src/img/close.svg",o.appendChild(r),r.appendChild(u),e.appendChild(o);let l=document.createElement("div");l.className="touit_date_box";let m=document.createElement("p");m.className="dateContent",m.textContent=formatTimestamp(E),l.appendChild(m),e.appendChild(l),messageContainer.prepend(e),a.addEventListener("click",function(){a.classList.toggle("active"),a.classList.contains("active")?addLike(function(){oneTouit(function(e){s.textContent=e.data.likes},function(){console.log("Erreur REFRESH ADD")},e.id),c.src="src/img/likefull.svg"},function(){console.log("Erreur ADD")},e.id):deleteLike(function(){oneTouit(function(e){s.textContent=e.data.likes},function(){console.log("Erreur REFRESH DELETE")},e.id),c.src="src/img/like.svg"},function(){console.log("Erreur DELETE")},e.id)})}}function getTouit(e,t,n){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/list?ts="+e,!0),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),console.log(e),t(e)):n(status))}),o.send()}function oneTouit(t,n,e){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/get?id="+e,!0),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))}),o.send()}function formatTimestamp(e){return new Date(1e3*e).toLocaleDateString("fr-FR")}function sendTouit(t,n,e,o){const s=new XMLHttpRequest;s.open("POST","http://touiteur.cefim-formation.org/send",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.addEventListener("readystatechange",function(){var e;s.readyState===XMLHttpRequest.DONE&&(200===s.status?(e=JSON.parse(s.responseText),console.log("reponse passe"),t(e),console.log("et Ã§a passe")):(n(status),console.log("aie")))});o="name="+e+"&message="+o;s.send(o)}formulaireInput.addEventListener("submit",function(e){e.preventDefault(),sendTouit(function(){console.log("coucou")},function(){console.log("coucou sEND")},nameInput.value,msgInput.value)});let timestamp=0;function addLike(t,n,e){const o=new XMLHttpRequest;o.open("PUT","http://touiteur.cefim-formation.org/likes/send",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))});e="message_id="+e;o.send(e)}function deleteLike(t,n,e){const o=new XMLHttpRequest;o.open("DELETE","http://touiteur.cefim-formation.org/likes/remove",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))});e="message_id="+e;o.send(e)}setInterval(function(){getTouit(timestamp,function(t){for(let e=0;e<t.messages.length;e++)addTouit(t.messages[e].name,t.messages[e].message,t.messages[e].likes,t.messages[e].comments_count,t.messages[e].ts,t.messages[e].id),timestamp=t.ts},function(){console.log("Coucou1")})},1e3);const likeContainer=document.querySelector(".like_content");function mostLiked(c,i,d,r){if(i){let e=document.createElement("article");e.className="like_card",e.id=r;let t=document.createElement("p");t.className="like_message";i=document.createTextNode(i);t.appendChild(i),e.appendChild(t);let n=document.createElement("p");n.className="like_pseudo";c=document.createTextNode(c);n.appendChild(c),e.appendChild(n);let o=document.createElement("div");o.className="like_number";let s=document.createElement("img");s.src="src/img/number.svg";let a=document.createElement("p");a.className="number_total",a.textContent=d,e.appendChild(o),o.appendChild(s),o.appendChild(a),likeContainer.appendChild(e)}}function addMostLiked(t,n,e){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/likes/top?count="+e,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))}),o.send()}addMostLiked(function(e){var t=e.top.sort(function(e,t){return t.likes-e.likes});for(let e=0;e<t.length;e++)mostLiked(t[e].name,t[e].message,t[e].likes,t[e].id)},function(){console.log("Coucou6")},3);const wordsContainer=document.querySelector("words_box");function bestWords(n,o){if(n){let e=document.createElement("article");e.className="words_card",e.id=o;let t=document.createElement("p");t.className="words_display";n=document.createTextNode(n);e.appendChild(t),t.appendChild(n),wordsContainer.prepend(e)}}function addBestWords(t,n){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/trending",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))}),o.send()}addBestWords(function(t){for(let e=0;e<t.messages.length;e++)bestWords(t.messages[e].message,t.messages[e].id)},function(){console.log("Coucou1")},3);