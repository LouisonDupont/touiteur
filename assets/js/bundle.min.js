const nameInput=document.querySelector("#pseudo"),msgInput=document.querySelector("#msg"),checkButton=document.querySelector("#buttonInput"),messageContainer=document.querySelector(".touit_content"),formulaireInput=document.querySelector("#form");let currentTimeStamp=0;function addTouit(r,p,g,e,f,E){if(p){let e=document.createElement("article");e.className="touit",e.id=E;let t=document.createElement("p");t.className="touit_pseudo";r=document.createTextNode(r);t.appendChild(r),e.appendChild(t);let n=document.createElement("p");n.className="touit_message";p=document.createTextNode(p);n.appendChild(p),e.appendChild(n);let o=document.createElement("div");o.className="touit_icone_box";let s=document.createElement("p");s.className="likeNb",s.textContent=g;let a=document.createElement("button");a.className="like";let c=document.createElement("img");c.src="src/img/like.svg";let u=document.createElement("button");u.className="comment";let i=document.createElement("img");i.src="src/img/comment.svg";let m=document.createElement("button");m.className="close";let d=document.createElement("img");d.src="src/img/close.svg";let l=document.createElement("p");l.className="dateContent",l.textContent=formatTimestamp(f),o.appendChild(a),o.appendChild(s),a.appendChild(c),o.appendChild(u),o.appendChild(l),u.appendChild(i),o.appendChild(m),m.appendChild(d),e.appendChild(o),messageContainer.prepend(e),m.addEventListener("click",function(){messageContainer.removeChild(e)}),a.addEventListener("click",function(){addLike(function(){console.log("et oui")},function(){console.log("et non")},e.id)})}}function getTouit(e,t,n){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/list?ts="+e,!0),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),console.log(e),t(e)):n(status))}),o.send()}function formatTimestamp(e){return new Date(1e3*e).toLocaleDateString("fr-FR")}function sendTouit(t,n,e,o){const s=new XMLHttpRequest;s.open("POST","http://touiteur.cefim-formation.org/send",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.addEventListener("readystatechange",function(){var e;s.readyState===XMLHttpRequest.DONE&&(200===s.status?(e=JSON.parse(s.responseText),console.log("reponse passe"),t(e),console.log("et Ã§a passe")):(n(status),console.log("aie")))});o="name="+e+"&message="+o;s.send(o)}formulaireInput.addEventListener("submit",function(e){e.preventDefault(),sendTouit(function(){console.log("coucou")},function(){console.log("coucou sEND")},nameInput.value,msgInput.value)});let timestamp=0;function addLike(t,n,e){const o=new XMLHttpRequest;o.open("PUT","http://touiteur.cefim-formation.org/likes/send",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))});e="message_id="+e;o.send(e)}setInterval(function(){getTouit(timestamp,function(t){for(let e=0;e<t.messages.length;e++)addTouit(t.messages[e].name,t.messages[e].message,t.messages[e].likes,t.messages[e].comments_count,t.messages[e].ts,t.messages[e].id),timestamp=t.ts},function(){console.log("Error : Not working!")})},1e3);